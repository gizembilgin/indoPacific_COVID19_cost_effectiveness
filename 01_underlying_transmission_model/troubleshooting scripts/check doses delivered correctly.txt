            dose1_delivered_today = 0
      dose2_delivered_today = 0
     
           #dose1_delivered_today = dose1_delivered_today + sum(VR_this_step$doses[VR_this_step$dose == 1])
           #dose2_delivered_today = dose2_delivered_today + sum(VR_this_step$doses[VR_this_step$dose == 2])
      
               dose1_delivered_today = dose1_delivered_today +  increase[1]* prop[1]
               dose2_delivered_today = dose2_delivered_today +  increase[2]* prop[2]
      
###CHECK why not aliginging with vaccination_history_TRUE (use dose 1)
      if (fitting == "on"){
        
        if (date_now - vaxCovDelay$delay[vaxCovDelay$dose == 1] >= min(vaccination_history_TRUE$date)){
          if (round(dose1_delivered_today,digits=2) != 
              round(sum(vaccination_history_TRUE$doses_delivered_this_date[vaccination_history_TRUE$dose == 1 & vaccination_history_TRUE$date == (date_now - vaxCovDelay$delay[vaxCovDelay$dose == 1])]),digits=2)){
            stop('dose 1 not delivered properly')
            dose1_delivered_today - sum(vaccination_history_TRUE$doses_delivered_this_date[vaccination_history_TRUE$dose == 1 & vaccination_history_TRUE$date == (date_now - vaxCovDelay$delay[vaxCovDelay$dose == 1])])
          }
        }
        
        if (date_now - vaxCovDelay$delay[vaxCovDelay$dose == 2] >= min(vaccination_history_TRUE$date)){
          if (round(dose2_delivered_today,digits=2) != 
              round(sum(vaccination_history_TRUE$doses_delivered_this_date[vaccination_history_TRUE$dose == 2 & vaccination_history_TRUE$date == (date_now - vaxCovDelay$delay[vaxCovDelay$dose == 2])]),digits=2)){
            stop('dose 2 not delivered properly')
          }
        }

        dose2_expected = vaccination_history_TRUE %>% 
          filter( date <= (date_now - vaxCovDelay$delay[vaxCovDelay$dose == 2]) & dose == 2 & doses_delivered_this_date>0)
        dose2_existing = next_state %>% filter(dose == 2)
        if (round(sum(dose2_expected$doses_delivered_this_date),digits=2) != round(sum(dose2_existing$pop),digits=2)){stop('dose coverage does not align!')} 
        
        dose1_expected = vaccination_history_TRUE %>% 
          filter( date <= (date_now - vaxCovDelay$delay[vaxCovDelay$dose == 1]) & dose == 1 & doses_delivered_this_date>0)
        
        dose1_existing = next_state %>% filter(dose == 1)
        
        dose1_expected_sum = round(sum(dose1_expected$doses_delivered_this_date),digits=2) - round(sum(dose2_expected$doses_delivered_this_date),digits=2)
        
        if (dose1_expected_sum != round(sum(dose1_existing$pop),digits=2)){stop('dose coverage does not align!')} 
        

        dose1_expected_sum -  sum(dose1_existing$pop)
        
        #view = vaccination_history_TRUE %>% group_by(date,dose) %>% summarise(delivered= sum(doses_delivered_this_date)) %>% filter(delivered>0 & date <date_now) 
        
        
      }